<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Index</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
	
	#main-container{
		display: flex;
	}
	.form-container{
		width: 40%;
		align-items: center;
		margin: 20px 50px 20px 50px;
	}
	
	h2{
		color: #0655ff;
		
	}
	
	.student-container{
			width: 50%;
			align-items: center;
			margin: 20px 50px 20px 50px;
	}
	
	table {
	            width: 100%;
	            border-collapse: collapse;
	        }
	        table, th, td {
	            border: 1px solid black;
	        }
	        th, td {
	            padding: 10px;
	            text-align: center;
	        }
	        th {
	            background-color: rgb(208, 232, 255);
	        }
	
</style>
</head>
<body>

<div id="main-container">
<div class="form-container">
	<center>
	<h2 class="headline">Student Registration</h2>
	<br/>
<form id="studentForm" action="/students/register" method="post">
	<div class="form-floating mb-1">
	  <input type="name" class="form-control" id="floatingInput" name="sName">
	  <label for="floatingInput">Full Name</label>
	</div>
	<br/>
	<div class="form-floating mb-1">
	  <input type="text" class="form-control" id="floatingInput" name="sPhone">
	  <label for="floatingInput">Phone No</label>
	</div>
	<br/>
	<div class="form-floating mb-3">
	  <input type="email" class="form-control" id="floatingInput" name="sEmail">
	  <label for="floatingInput">Email address</label>
	</div>
	<br/>

	<div class="form-floating">
	  <select class="form-select" id="floatingSelect" name="sCourse" aria-label="Floating label select example">
		<option value="mca">MCA</option>
			<option value="mba">MBA</option>
			<option value="bTech">BTech</option>
			<option value="mbbs">MBBS</option>
	  </select>
	  <label for="floatingSelect">Select Course</label>
	</div>
	<br/>

	<div class="form-floating mb-3">
	  <input type="password" class="form-control" id="floatingInput" name="sPassword">
	  <label for="floatingInput">Password</label>
	</div>
	<br/>
	<button type="submit" class="btn btn-primary btn-lg">Submit</button>	
	<br/>
</form>
</center>
</div>
<div class="student-container">
	<center>

	<h2>Student List</h2>
	</br>
	    <table id="studentTable">
	        <thead>
	            <tr>
	                <th>Name</th>
	                <th>Email</th>
	                <th>Phone</th>
	                <th>Course</th>
					<th>Password</th>
					<th></th>
					<th></th>
	            </tr>
	        </thead>
	        <tbody>
	            
	        </tbody>
	    </table>
		<center>

</div>
</div>

<script>
	
		async function fetchStudents() {
	            try {
	                const response = await fetch('/students/');
	                if (!response.ok) {
	                    throw new Error('Failed to fetch students');
	                }
	                const students = await response.json();

	                // Populate the table
	                const tableBody = document.getElementById('studentTable').querySelector('tbody');
	                tableBody.innerHTML = ''; // Clear existing rows
	                
	                students.forEach(student => {
	                    const row = document.createElement('tr');
	                    row.innerHTML = `
	                        <td>${student.sName}</td>
	                        <td>${student.sEmail}</td>
	                        <td>${student.sPhone}</td>
	                        <td>${student.sCourse}</td>
							<td>${student.sPassword}</td>
							<td><button class="btn">Edit</button></td> //onclick="editStudent(${index})" 
							<td>Delete</td>
	                    `;
	                    tableBody.appendChild(row);
	                });
	            } catch (error) {
	                console.error('Error fetching students:', error);
	            }
	        }

	        
		function editStudent(student) {
			    const student = students[index];
			    if (!student) return;

			    document.querySelector('input[name="sName"]').value = student.sName;
			    document.querySelector('input[name="sPhone"]').value = student.sPhone;
			    document.querySelector('input[name="sEmail"]').value = student.sEmail;
			    document.querySelector('select[name="sCourse"]').value = student.sCourse;
			    document.querySelector('input[name="sPassword"]').value = student.sPassword;

			    // Optionally, store the student ID in a hidden field for update operations
			    document.getElementById('studentId').value = student.id;
			}	
	
        document.getElementById("studentForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            
            // Collect form data
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            console.log(formData.toString());
            try {
                // Send POST request
                const response = await fetch("/students/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }, //"application/x-www-form-urlencoded" },
                    body: JSON.stringify(data) //formData.toString(),
                });

                const message = await response.text(); 

                // Display toast notification
                if (response.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "Success!",
                        text: message,
                        timer: 3000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Error!",
                        text: message,
                        timer: 5000,
                        showConfirmButton: false
                    });
                }
            } catch (error) {
                Swal.fire({
                    icon: "error",
                    title: "Error!",
                    text: "An unexpected error occurred.",
                    timer: 5000,
                    showConfirmButton: false
                });
            }
        });

		
		// Fetch students when the page loads
		window.onload = fetchStudents;
					
		</script>

</body>
</html>

